{"ast":null,"code":"// index.ts\nimport { distanceWeight as spatialWeight } from \"@turf/distance-weight\";\nimport { featureEach } from \"@turf/meta\";\nfunction moranIndex(fc, options) {\n  var _a, _b;\n  const inputField = options.inputField;\n  const threshold = options.threshold || 1e5;\n  const p = options.p || 2;\n  const binary = (_a = options.binary) != null ? _a : false;\n  const alpha = options.alpha || -1;\n  const standardization = (_b = options.standardization) != null ? _b : true;\n  const weight = spatialWeight(fc, {\n    alpha,\n    binary,\n    p,\n    standardization,\n    threshold\n  });\n  const y = [];\n  featureEach(fc, feature => {\n    const feaProperties = feature.properties || {};\n    y.push(feaProperties[inputField]);\n  });\n  const yMean = mean(y);\n  const yVar = variance(y);\n  let weightSum = 0;\n  let s0 = 0;\n  let s1 = 0;\n  let s2 = 0;\n  const n = weight.length;\n  for (let i = 0; i < n; i++) {\n    let subS2 = 0;\n    for (let j = 0; j < n; j++) {\n      weightSum += weight[i][j] * (y[i] - yMean) * (y[j] - yMean);\n      s0 += weight[i][j];\n      s1 += Math.pow(weight[i][j] + weight[j][i], 2);\n      subS2 += weight[i][j] + weight[j][i];\n    }\n    s2 += Math.pow(subS2, 2);\n  }\n  s1 = 0.5 * s1;\n  const moranIndex2 = weightSum / s0 / yVar;\n  const expectedMoranIndex = -1 / (n - 1);\n  const vNum = n * n * s1 - n * s2 + 3 * (s0 * s0);\n  const vDen = (n - 1) * (n + 1) * (s0 * s0);\n  const vNorm = vNum / vDen - expectedMoranIndex * expectedMoranIndex;\n  const stdNorm = Math.sqrt(vNorm);\n  const zNorm = (moranIndex2 - expectedMoranIndex) / stdNorm;\n  return {\n    expectedMoranIndex,\n    moranIndex: moranIndex2,\n    stdNorm,\n    zNorm\n  };\n}\nfunction mean(y) {\n  let sum = 0;\n  for (const item of y) {\n    sum += item;\n  }\n  return sum / y.length;\n}\nfunction variance(y) {\n  const yMean = mean(y);\n  let sum = 0;\n  for (const item of y) {\n    sum += Math.pow(item - yMean, 2);\n  }\n  return sum / y.length;\n}\nvar turf_moran_index_default = moranIndex;\nexport { turf_moran_index_default as default, moranIndex };\n//# sourceMappingURL=index.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}