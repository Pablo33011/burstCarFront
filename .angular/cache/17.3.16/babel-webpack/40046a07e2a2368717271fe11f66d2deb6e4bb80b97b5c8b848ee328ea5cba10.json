{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/santiago.cardenas/Desktop/Proyectos/Proyecto de grado/BurstCar/front/burstCarFront/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as mapboxgl from 'mapbox-gl';\nimport { environment } from 'src/environment/environment';\nimport { Geolocation } from '@capacitor/geolocation';\nimport * as i0 from \"@angular/core\";\nconst _c0 = [\"mapa\"];\nexport let MapaSelectorComponent = /*#__PURE__*/(() => {\n  class MapaSelectorComponent {\n    ngAfterViewInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        mapboxgl.accessToken = environment.mapboxAccessToken;\n        try {\n          const position = yield Geolocation.getCurrentPosition();\n          const coords = [position.coords.longitude, position.coords.latitude];\n          _this.mapa = new mapboxgl.Map({\n            container: _this.mapaContainer.nativeElement,\n            style: 'mapbox://styles/mapbox/streets-v12',\n            center: coords,\n            zoom: 14\n          });\n          const marker = new mapboxgl.Marker({\n            draggable: true\n          }).setLngLat(coords).addTo(_this.mapa);\n          _this.formGroup.patchValue({\n            latitud: coords[1],\n            longitud: coords[0]\n          });\n          marker.on('dragend', /*#__PURE__*/_asyncToGenerator(function* () {\n            const {\n              lng,\n              lat\n            } = marker.getLngLat();\n            _this.formGroup.patchValue({\n              latitud: lat,\n              longitud: lng\n            });\n            yield _this.obtenerDireccionDesdeCoordenadas(lat, lng);\n          }));\n          _this.mapa.on('click', /*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator(function* (e) {\n              const {\n                lng,\n                lat\n              } = e.lngLat;\n              marker.setLngLat([lng, lat]);\n              _this.formGroup.patchValue({\n                latitud: lat,\n                longitud: lng\n              });\n              yield _this.obtenerDireccionDesdeCoordenadas(lat, lng);\n            });\n            return function (_x) {\n              return _ref2.apply(this, arguments);\n            };\n          }());\n        } catch (error) {\n          console.error('Error obteniendo ubicación:', error);\n        }\n      })();\n    }\n    obtenerDireccionDesdeCoordenadas(lat, lng) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const response = yield fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=${environment.mapboxAccessToken}`);\n        const data = yield response.json();\n        const features = data.features;\n        const pais = features.find(f => f.place_type.includes('country'))?.text || '';\n        const departamento = features.find(f => f.place_type.includes('region'))?.text || '';\n        const ciudad = features.find(f => f.place_type.includes('place'))?.text || '';\n        const corregimiento = features.find(f => f.place_type.includes('locality') || f.place_type.includes('district') || f.place_type.includes('neighborhood'))?.text || '';\n        const viaFeature = features.find(f => f.place_type.includes('address'));\n        const numeroVia = viaFeature?.address || '';\n        const nombreVia = viaFeature?.text || '';\n        const placeName = viaFeature?.place_name || '';\n        const direccion = placeName.split(',')[0]?.match(/\\d+-\\d+/)?.[0] || '';\n        _this2.formGroup.patchValue({\n          nombrePais: pais,\n          nombreDepartamento: departamento,\n          nombreCiudad: ciudad,\n          nombreCorregimiento: corregimiento,\n          nombreVia: nombreVia,\n          numeroVia: numeroVia,\n          direccion: direccion\n        });\n      })();\n    }\n    redibujarMapa() {\n      setTimeout(() => {\n        if (this.mapa) {\n          this.mapa.resize();\n        }\n      }, 300);\n    }\n    static {\n      this.ɵfac = function MapaSelectorComponent_Factory(t) {\n        return new (t || MapaSelectorComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: MapaSelectorComponent,\n        selectors: [[\"app-mapa-selector\"]],\n        viewQuery: function MapaSelectorComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.mapaContainer = _t.first);\n          }\n        },\n        inputs: {\n          formGroup: \"formGroup\"\n        },\n        decls: 2,\n        vars: 0,\n        consts: [[\"mapa\", \"\"], [\"id\", \"mapa\", 2, \"width\", \"100%\", \"height\", \"300px\"]],\n        template: function MapaSelectorComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelement(0, \"div\", 1, 0);\n          }\n        },\n        styles: [\"#mapa[_ngcontent-%COMP%]{border:2px solid #6c8f6d;border-radius:12px}\"]\n      });\n    }\n  }\n  return MapaSelectorComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}